#include "gtest/gtest.h"
#include "CANSec.h"
#include <iostream>

TEST(Cryptography, SetKEY) {
    CANSec cansec;
    std::array<__uint8_t,32> key = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f};
    cansec.setKey(key);
    EXPECT_EQ(cansec.getKey(), key);
    std::cout<<"Test-1"<<std::endl;
}

TEST(Cryptography, EncryptionDecryptionTour) {

    CANSec cansec;
    std::array<__uint8_t,32> key = {};
    cansec.setKey(key);
    std::array<__uint8_t,32> plaintext = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f};
    std::array<__uint8_t,32> ciphertext = {};
    std::array<__uint8_t,16> tag = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f};
    int tem_cipher_len = ciphertext.size();
    cansec.EncryptMessage(plaintext, plaintext.size(), ciphertext, tem_cipher_len, tag);

    std::array<__uint8_t,32> decryptedtext = {};
    int tem_plain_len = decryptedtext.size();
    cansec.DecryptMessage(ciphertext, ciphertext.size(), decryptedtext, tem_plain_len, tag);
    EXPECT_EQ(plaintext, decryptedtext);
    std::cout<<"Test-2"<<std::endl;
}